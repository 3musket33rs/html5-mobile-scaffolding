var grails=grails||{};(function(){if(!grails.Events){grails.Events=function(e,t){function a(){var e=function(){s=grails.Events.OPEN;if(n.onopen){n.onopen()}};r.onOpen=e;r.onReconnect=e;r.onClose=function(e){s=grails.Events.CLOSED;if(n.onclose){n.onclose()}};r.onMessage=function(e){if(e.status==200){var t;if(e.responseBody.length>0){try{t=jQuery.parseJSON(e.responseBody)}catch(r){if(console!="undefined"){console.log("discarded message: "+e.responseBody)}return}var i=o[t&&t.topic?t.topic:n.globalTopicName];if(i){var s=i.slice(0);for(var u=0;u<s.length;u++){s[u](t.body,t,e)}}}}};n.globalTopicSocket=n.on(n.globalTopicName,function(e,t){if(n.onglobalmessage){n.onglobalmessage(e)}})}function f(){if(s!=grails.Events.OPEN){throw new Error("INVALID_STATE_ERR")}}function l(e,t,n,r){if(!r&&!n){throw new Error("Parameter "+e+" must be specified")}if(n&&typeof n!=t){throw new Error("Parameter "+e+" must be of type "+t)}}var n=this;var r=$.atmosphere;n.root=e&&typeof e=="string"?e:window.location.protocol+"//"+window.location.hostname+":"+window.location.port;var i=t&&typeof t=="object";n.globalTopicName=i&&t.globalTopicName&&typeof t.globalTopicName=="string"?t.globalTopicName:"eventsbus";n.path=i&&t.path&&typeof t.path=="string"?option.path:"g-eventsbus";var s=grails.Events.CONNECTING;n.onopen=null;n.onglobalmessage=null;n.onclose=null;var o={};var u="";n.send=function(e,t){l("topic","string",e);var r={topic:e,body:t};n.globalTopicSocket.push({data:jQuery.stringifyJSON(r)})};n.on=function(e,i,s){l("topic","string",e);l("handler","function",i);var a=o[e];if(!a||s){a=[i];o[e]=a;var f="";for(var c in o){f+=c+","}if(f[f.length-1]==","){f=f.substr(0,f.length-1)}var h=r.guid();var p={messageDelimiter:"<@>",trackMessageLength:true,headers:{topics:f},url:n.root+"/"+n.path+"/"+n.globalTopicName,transport:"websocket",fallbackTransport:"streaming",reconnectInterval:4e3,localId:h};if(!!window.EventSource){p.fallbackTransport="sse"}u=h;p=jQuery.extend(p,t);p=jQuery.extend(p,s);if(!n.globalTopicSocket){return r.subscribe(p)}else{r.unsubscribe();n.globalTopicSocket=r.subscribe(p);return n.globalTopicSocket}}else{a[a.length]=i}return n.globalTopicSocket};n.unregisterHandler=function(e,t){l("topic","string",e);l("handler","function",t);f();var i=o[e];if(i){var s=i.indexOf(t);if(s!=-1)i.splice(s,1);if(i.length==0){r.unsubscribeUrl(n.root+"/"+n.path+"/"+n.globalTopicName);a();delete o[e]}}};n.close=function(){s=grails.Events.CLOSING;r.unsubscribe()};n.readyState=function(){return s};a()};grails.Events.CONNECTING=0;grails.Events.OPEN=1;grails.Events.CLOSING=2;grails.Events.CLOSED=3}})()